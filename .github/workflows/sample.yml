name: static analysis and  test
'on':
  push:
    paths: #functions/が変わった時のみ動かす
      - 'functions/**'
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: install firebase-tools
        run: npm install -g firebase-tools
      - name: install node_modules
        run: npm ci
      - name: linter
        run: |
          npm run format
          npm run lint
        working-directory: ./functions
      - name: test
        run: firebase emulators:exec 'npm test' --project=twitch-clip-66e5b --only firestore --import test/test_data/firestore
        working-directory: ./functions
